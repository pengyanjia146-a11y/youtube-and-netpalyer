apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'

// --- 1. Ëá™Âä®Âà†Èô§Êä•ÈîôÁöÑÊóß‰ª£Á†Å (Ê†∏ÂºπÁ∫ß‰øÆÂ§ç) ---
// Êó¢ÁÑ∂ exclude ‰∏çÁîüÊïàÔºåÊàë‰ª¨Â∞±Áõ¥Êé•Âú®ÁºñËØëÂâçÊääÂÆÉ‰ª¨Âà†ÊéâÔºåÂΩªÂ∫ïÊ†πÈô§Êä•Èîô
task cleanupBrokenExamples(type: Delete) {
    def examplePath = "src/main/java/com/pierfrancescosoffritti/androidyoutubeplayer/core/sampleapp/examples"
    
    // Âà†Èô§Èô§‰∫Ü simpleExample ‰ª•Â§ñÁöÑÊâÄÊúâÁ§∫‰æãÊñá‰ª∂Â§π
    delete "$examplePath/chromecastExample"
    delete "$examplePath/completeExample"
    delete "$examplePath/composeExample"
    delete "$examplePath/customUiExample"
    delete "$examplePath/defaultCustomUiExample"
    delete "$examplePath/fragmentExample"
    delete "$examplePath/fullscreenExample"
    delete "$examplePath/iFramePlayerOptionsExample"
    delete "$examplePath/liveVideoExample"
    delete "$examplePath/noLifecycleObserverExample"
    delete "$examplePath/pictureInPictureExample"
    delete "$examplePath/playerStateExample"
    delete "$examplePath/playlistExample"
    delete "$examplePath/recyclerViewExample"
    delete "$examplePath/viewPagerExample"
    
    println "üßπ Cleaned up broken example files to ensure smooth build."
}

// Á°Æ‰øùÊØèÊ¨°ÊûÑÂª∫ÂâçÈÉΩÂÖàÊ∏ÖÁêÜ
preBuild.dependsOn cleanupBrokenExamples

// --- 2. Ëá™Âä®ÁâàÊú¨ÁÆ°ÁêÜ ---
def versionPropsFile = file('version.properties')
def versionProps = new Properties()
if (versionPropsFile.canRead()) {
    versionProps.load(new FileInputStream(versionPropsFile))
} else {
    versionProps['VERSION_CODE'] = '1'
    versionProps['VERSION_NAME'] = '1.0.0'
    versionProps.store(versionPropsFile.newWriter(), null)
}
task autoIncrementVersion {
    doLast {
        def code = versionProps['VERSION_CODE'].toInteger() + 1
        def name = "1.0." + code 
        versionProps['VERSION_CODE'] = code.toString()
        versionProps['VERSION_NAME'] = name
        versionProps.store(versionPropsFile.newWriter(), null)
    }
}
tasks.whenTaskAdded { task ->
    if (task.name == 'assembleDebug' || task.name == 'assembleRelease') {
        task.dependsOn autoIncrementVersion
    }
}

android {
    namespace 'com.pierfrancescosoffritti.androidyoutubeplayer.core.sampleapp'
    compileSdk 36

    defaultConfig {
        applicationId "com.pierfrancescosoffritti.androidyoutubeplayer.core.sampleapp"
        minSdk 21
        targetSdk 36
        versionCode versionProps['VERSION_CODE'].toInteger()
        versionName versionProps['VERSION_NAME']
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    
    // ‰øùÊåÅ Java 17ÔºåÂåπÈÖç Kotlin
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }
    kotlinOptions {
        jvmTarget = '17'
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    implementation 'androidx.appcompat:appcompat:1.6.1'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
    implementation 'com.google.android.material:material:1.11.0'
    
    // ÂºïÁî®Êú¨Âú∞Ê®°Âùó
    implementation project(':core')
    implementation project(':custom-ui')
    
    testImplementation 'junit:junit:4.13.2'
    androidTestImplementation 'androidx.test.ext:junit:1.1.5'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'
}
