apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'

// --- è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†é€»è¾‘ å¼€å§‹ ---
// 1. å®šä¹‰ç‰ˆæœ¬æ–‡ä»¶å¯¹è±¡
def versionPropsFile = file('version.properties')
def versionProps = new Properties()

// 2. åŠ è½½æˆ–åˆå§‹åŒ–ç‰ˆæœ¬ä¿¡æ¯
if (versionPropsFile.canRead()) {
    versionProps.load(new FileInputStream(versionPropsFile))
} else {
    // å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆå§‹åŒ–ä¸º 1
    versionProps['VERSION_CODE'] = '1'
    versionProps['VERSION_NAME'] = '1.0.0'
    versionProps.store(versionPropsFile.newWriter(), null)
}

// 3. å®šä¹‰é€’å¢ä»»åŠ¡
task autoIncrementVersion {
    doLast {
        // è¯»å–æ—§ç‰ˆæœ¬å·
        def code = versionProps['VERSION_CODE'].toInteger() + 1
        
        // ç”Ÿæˆæ–°ç‰ˆæœ¬å (ä¾‹å¦‚: 1.0.1 -> 1.0.2)
        def name = "1.0." + code 

        // ä¿å­˜å›æ–‡ä»¶
        versionProps['VERSION_CODE'] = code.toString()
        versionProps['VERSION_NAME'] = name
        versionProps.store(versionPropsFile.newWriter(), null)
        
        println("ğŸš€ Version Bumped to: " + name + " (" + code + ")")
    }
}

// 4. å°†é€’å¢ä»»åŠ¡ç»‘å®šåˆ°æ‰“åŒ…æµç¨‹ (Debug/Release)
// è¿™æ ·æ¯æ¬¡ä½ åœ¨æœ¬åœ°æˆ–äº‘ç«¯æ‰“åŒ…ï¼Œç‰ˆæœ¬éƒ½ä¼šè‡ªåŠ¨ +1
tasks.whenTaskAdded { task ->
    if (task.name == 'assembleDebug' || task.name == 'assembleRelease') {
        task.dependsOn autoIncrementVersion
    }
}
// --- è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†é€»è¾‘ ç»“æŸ ---

android {
    namespace 'com.pierfrancescosoffritti.androidyoutubeplayer.core.sampleapp'
    compileSdk 34

    defaultConfig {
        applicationId "com.pierfrancescosoffritti.androidyoutubeplayer.core.sampleapp"
        minSdk 21
        targetSdk 34
        
        // ğŸ”´ ä½¿ç”¨è‡ªåŠ¨ç®¡ç†çš„ç‰ˆæœ¬å·
        versionCode versionProps['VERSION_CODE'].toInteger()
        versionName versionProps['VERSION_NAME']

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    
    implementation 'androidx.appcompat:appcompat:1.6.1'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
    implementation 'com.google.android.material:material:1.11.0'

    // YouTube æ ¸å¿ƒåº“
    implementation 'com.pierfrancescosoffritti.androidyoutubeplayer:core:12.1.0'

    testImplementation 'junit:junit:4.13.2'
    androidTestImplementation 'androidx.test.ext:junit:1.1.5'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'
}
